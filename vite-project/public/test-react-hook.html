<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test React Stockfish Hook</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .loading { background-color: #fff3cd; }
        .ready { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
    </style>
</head>
<body>
    <h1>React Stockfish Hook Test</h1>
    <div id="app">Loading...</div>

    <script type="module">
        // Simple test of the React hook logic
        console.log('üß™ Testing React hook logic...');
        
        // Simulate the hook behavior
        let isReady = false;
        let workerSource = '';
        
        function updateStatus() {
            const app = document.getElementById('app');
            if (!isReady) {
                app.innerHTML = \`
                    <div class="status loading">
                        üîÑ Loading Stockfish Engine... \${workerSource ? \`(trying: \${workerSource.split('/').pop()})\` : ''}
                    </div>
                \`;
            } else {
                app.innerHTML = \`
                    <div class="status ready">
                        ‚úÖ Stockfish Ready ‚Ä¢ Source: \${workerSource.split('/').pop()}
                    </div>
                \`;
            }
        }
        
        // Initial render
        updateStatus();
        
        // Test the minimal stockfish approach
        console.log('üöÄ Testing minimal Stockfish approach...');
        
        const workerCode = \`
          console.log('Worker starting...');
          importScripts('https://cdn.jsdelivr.net/npm/stockfish@16/stockfish.min.js');
          
          let stockfish;
          try {
            stockfish = Stockfish();
            console.log('Stockfish created');
          } catch (e) {
            console.error('Failed to create Stockfish:', e);
          }
          
          self.onmessage = function(e) {
            console.log('Worker received:', e.data);
            if (stockfish) {
              stockfish.postMessage(e.data);
            }
          };
          
          if (stockfish) {
            stockfish.onmessage = function(event) {
              console.log('Stockfish says:', event);
              self.postMessage(event);
            };
          }
        \`;
        
        try {
            const blob = new Blob([workerCode], { type: 'application/javascript' });
            const workerUrl = URL.createObjectURL(blob);
            const worker = new Worker(workerUrl);
            workerSource = 'Inline Worker';
            
            console.log('‚úÖ Worker created');
            updateStatus();
            
            worker.onmessage = (event) => {
                const line = event.data;
                console.log('üì® From worker:', line);
                
                if (typeof line === 'string') {
                    if (line.includes('uciok')) {
                        console.log('‚úÖ UCI OK received');
                        worker.postMessage('isready');
                    } else if (line.includes('readyok')) {
                        isReady = true;
                        console.log('‚úÖ Stockfish ready!');
                        updateStatus();
                    }
                }
            };
            
            worker.onerror = (error) => {
                console.error('‚ùå Worker error:', error);
                document.getElementById('app').innerHTML = \`
                    <div class="status error">
                        ‚ùå Worker Error: \${error.message}
                    </div>
                \`;
            };
            
            // Start UCI
            setTimeout(() => {
                console.log('üì§ Sending UCI...');
                worker.postMessage('uci');
            }, 1000);
            
        } catch (error) {
            console.error('‚ùå Failed to create worker:', error);
            document.getElementById('app').innerHTML = \`
                <div class="status error">
                    ‚ùå Failed to create worker: \${error.message}
                </div>
            \`;
        }
    </script>
</body>
</html>
