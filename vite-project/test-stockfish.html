<!DOCTYPE html>
<html>
<head>
  <title>Stockfish Input Output Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .console {
      background: #1e1e1e;
      color: #00ff00;
      padding: 20px;
      border-radius: 5px;
      height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      margin: 20px 0;
    }
    button {
      background: #007acc;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 3px;
      cursor: pointer;
    }
    button:hover {
      background: #005a9e;
    }
    input {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 3px;
      width: 300px;
    }
  </style>
</head>
<body>
  <h2>Stockfish Input/Output Demo</h2>
  <p>Watch the console below to see Stockfish's response</p>
  
  <div>
    <input type="text" id="fenInput" placeholder="Enter FEN position" 
           value="rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq e6 0 2">
    <button onclick="setPosition()">Set Position</button>
    <button onclick="getBestMove()">Get Best Move</button>
    <button onclick="clearConsole()">Clear Console</button>
  </div>

  <div class="console" id="console">
    <div>üß† Stockfish Console - Ready to start...</div>
  </div>

  <script>
    let stockfish;
    let isReady = false;
    
    function log(message) {
      const console = document.getElementById('console');
      const timestamp = new Date().toLocaleTimeString();
      console.innerHTML += `<div>[${timestamp}] ${message}</div>`;
      console.scrollTop = console.scrollHeight;
    }

    function clearConsole() {
      document.getElementById('console').innerHTML = '<div>üß† Stockfish Console - Cleared</div>';
    }

    // Initialize Stockfish
    function initStockfish() {
      try {
        // Try to load local Stockfish first, then fallback to CDN
        stockfish = new Worker('./stockfish.js');
        log('üì¶ Loading local Stockfish engine...');
      } catch (error) {
        log('‚ö†Ô∏è Local Stockfish not found, trying CDN...');
        try {
          stockfish = new Worker('https://cdn.jsdelivr.net/npm/stockfish@11/stockfish.js');
          log('üì¶ Loading Stockfish from CDN...');
        } catch (cdnError) {
          log('‚ùå Failed to load Stockfish: ' + cdnError.message);
          return;
        }
      }

      // Setup message listener to read output
      stockfish.onmessage = function (e) {
        const message = e.data;
        log("üß† Stockfish: " + message);
        
        // Check for specific responses
        if (message.includes('readyok')) {
          isReady = true;
          log('‚úÖ Stockfish is ready!');
        } else if (message.startsWith('bestmove')) {
          const move = message.split(' ')[1];
          log(`üéØ Best move found: ${move}`);
        }
      };

      stockfish.onerror = function(error) {
        log('‚ùå Stockfish error: ' + error.message);
      };

      // Initialize UCI protocol
      log('üöÄ Initializing UCI protocol...');
      stockfish.postMessage("uci");
      stockfish.postMessage("isready");
      stockfish.postMessage("ucinewgame");
    }

    function setPosition() {
      if (!isReady) {
        log('‚ö†Ô∏è Stockfish not ready yet!');
        return;
      }
      
      const fen = document.getElementById('fenInput').value;
      log(`üéØ Setting position: ${fen}`);
      stockfish.postMessage("position fen " + fen);
    }

    function getBestMove() {
      if (!isReady) {
        log('‚ö†Ô∏è Stockfish not ready yet!');
        return;
      }
      
      log('ü§î Asking Stockfish to think (depth 10)...');
      stockfish.postMessage("go depth 10");
    }

    // Start when page loads
    window.onload = function() {
      initStockfish();
    };
  </script>
</body>
</html>
